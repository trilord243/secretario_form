<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Test de Intereses Vocacionales UNIMET</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      body {
        font-family: "Inter", sans-serif;
        background-color: #f0f2f5;
        display: flex;
        justify-content: center;
        align-items: flex-start;
        min-height: 100vh;
        padding: 20px;
      }
      .container {
        background-color: #ffffff;
        border-radius: 15px;
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        padding: 30px;
        width: 100%;
        max-width: 800px;
        margin-top: 20px;
      }
      .btn {
        @apply px-6 py-3 rounded-lg font-semibold transition-colors duration-200 ease-in-out;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      }
      .btn-primary {
        @apply bg-blue-600 text-white hover:bg-blue-700;
      }
      .btn-secondary {
        @apply bg-gray-300 text-gray-800 hover:bg-gray-400;
      }
      .btn-success {
        @apply bg-green-600 text-white hover:bg-green-700;
      }
      .input-field {
        @apply w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500;
      }
      .checkbox-option {
        @apply flex items-center p-4 border border-gray-200 rounded-lg cursor-pointer hover:bg-blue-50 transition-colors duration-150;
      }
      .checkbox-option input[type="checkbox"] {
        @apply mr-3 h-5 w-5 text-blue-600;
      }
      .checkbox-option.selected {
        @apply bg-blue-100 border-blue-500 ring-2 ring-blue-500;
      }
      .kuder-area-tag {
        @apply inline-block bg-blue-100 text-blue-800 text-xs font-medium px-2.5 py-0.5 rounded-full mr-2 mb-2;
      }
      .profile-text {
        line-height: 1.6;
      }
      .results-section h3 {
        border-left: 4px solid #3b82f6;
        padding-left: 1rem;
        margin-bottom: 1rem;
      }
      .question-instruction {
        @apply text-sm text-gray-500 mt-2 font-normal;
      }
    </style>
  </head>
  <body class="bg-gray-100 flex items-center justify-center min-h-screen p-4">
    <div class="container">
      <h1 class="text-3xl font-bold text-center text-gray-800 mb-8">
        Test de Intereses Vocacionales UNIMET
      </h1>

      <!-- Sección de Bienvenida e Información del Alumno -->
      <div id="intro-section" class="space-y-6">
        <p class="text-gray-700 text-lg text-center">
          ¡Bienvenido(a) a tu Test de Intereses Vocacionales! En este estudio te
          haremos 15 afirmaciones y en cada una podrás escoger hasta 2 frases.
          El objetivo es ayudarte a descubrir tus preferencias y a orientarte
          hacia las carreras y *minors* de la Universidad Metropolitana que
          mejor se adapten a ti.
        </p>
        <p class="text-gray-700 text-center">
          Por favor, ingresa tus datos para comenzar:
        </p>
        <div class="space-y-4">
          <div>
            <label
              for="student-name"
              class="block text-gray-700 text-sm font-semibold mb-2"
              >Nombre Completo:</label
            >
            <input
              type="text"
              id="student-name"
              class="input-field"
              placeholder="Ej: María Pérez"
              required
            />
          </div>
          <div>
            <label
              for="student-id"
              class="block text-gray-700 text-sm font-semibold mb-2"
              >Cédula de Identidad:</label
            >
            <input
              type="text"
              id="student-id"
              class="input-field"
              placeholder="Ej: V-12345678"
              required
            />
          </div>
        </div>
        <button id="start-test-btn" class="btn btn-primary w-full mt-6">
          Comenzar Test
        </button>
      </div>

      <!-- Sección del Cuestionario -->
      <div id="test-section" class="hidden">
        <div class="text-center text-gray-600 mb-6">
          Pregunta <span id="current-question-number">1</span> de
          <span id="total-questions">15</span>
        </div>
        <div class="bg-blue-50 p-6 rounded-lg mb-6">
          <p
            id="question-text"
            class="text-xl font-semibold text-gray-800 mb-1"
          ></p>
          <p class="question-instruction">
            Puedes seleccionar hasta 2 opciones.
          </p>
          <div id="options-container" class="space-y-4 mt-4">
            <!-- Opciones de respuesta se inyectarán aquí -->
          </div>
        </div>
        <div class="flex justify-between mt-6">
          <button id="prev-question-btn" class="btn btn-secondary" disabled>
            Anterior
          </button>
          <button id="next-question-btn" class="btn btn-primary">
            Siguiente
          </button>
          <button id="submit-test-btn" class="btn btn-success hidden">
            Finalizar Test
          </button>
        </div>
      </div>

      <!-- Sección de Resultados -->
      <div id="results-section" class="hidden">
        <h2 class="text-2xl font-bold text-center text-gray-800 mb-6">
          Tus Resultados Vocacionales
        </h2>
        <div class="bg-blue-50 p-6 rounded-lg mb-6 results-section">
          <p class="text-lg text-gray-700 mb-4">
            ¡Felicidades,
            <span id="results-student-name" class="font-semibold"></span>!
            Basado en tus respuestas, este es tu perfil de intereses:
          </p>

          <h3>Perfil Único Unimetano</h3>
          <p class="profile-text text-gray-700 mb-6">
            Elige una formación que te defina. En la UNIMET, tu camino
            profesional no está limitado a una sola carrera, sino que puedes
            construir un perfil único a través de la combinación de tu carrera
            principal con uno o más minors. Esta visión te prepara para ser un
            profesional con habilidades multidisciplinarias, capaz de innovar,
            liderar y adaptarte a los desafíos del mundo laboral. Un estudiante
            que combina Ingeniería Civil con un Minor en "Gestión Ambiental" no
            solo construye edificios, sino que lo hace de forma sostenible. Un
            estudiante de Derecho con un Minor en "Mercadeo Digital" puede
            liderar estrategias de comunicación en un bufete. La flexibilidad de
            nuestro modelo te permite ser el arquitecto de tu propio futuro.
          </p>

          <h3>Tus Intereses Principales:</h3>
          <div id="top-interests-display" class="mb-6 flex flex-wrap">
            <!-- Top intereses se inyectarán aquí -->
          </div>
          <h3>Carreras Sugeridas en la UNIMET:</h3>
          <ul
            id="career-suggestions"
            class="list-disc pl-5 text-gray-700 mb-6 space-y-2"
          >
            <!-- Sugerencias de carrera se inyectarán aquí -->
          </ul>
          <h3>Minors Sugeridos en la UNIMET:</h3>
          <ul
            id="minor-suggestions"
            class="list-disc pl-5 text-gray-700 space-y-2"
          >
            <!-- Sugerencias de minors se inyectarán aquí -->
          </ul>
          <p class="text-center mt-8 text-blue-600 font-semibold profile-text">
            Este estudio te permite acercarte a tu decisión vocacional y
            construir tu plan de carrera en la Unimet. Si quieres profundizar
            más, escríbenos a la
            <a
              href="mailto:DDBE@UNIMET.EDU.VE"
              class="text-blue-800 hover:underline"
              >DDBE@UNIMET.EDU.VE</a
            >
            para que participes en nuestro programa vocacional sin ningún costo.
          </p>
        </div>
        <div class="flex justify-center mt-6">
          <button id="export-results-btn" class="btn btn-primary">
            Exportar Resultados
          </button>
        </div>
      </div>

      <!-- Sección de Mensajes (para errores o info) -->
      <div
        id="message-box"
        class="hidden bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mt-6"
        role="alert"
      >
        <strong class="font-bold">Error:</strong>
        <span class="block sm:inline" id="message-text"></span>
      </div>
    </div>

    <script>
      // --- Datos del Cuestionario Kuder (15 preguntas con 5 opciones cada una) ---
      const kuderQuestions = [
        {
          id: 1,
          text: "¿Qué actividad prefieres?",
          options: [
            {
              text: "Resolver problemas de lógica y programación.",
              kuder_area: "Científica",
            },
            {
              text: "Dirigir un equipo de ventas.",
              kuder_area: "Comunicacional",
            },
            {
              text: "Manejar datos y estadísticas para un negocio.",
              kuder_area: "Cálculo",
            },
            {
              text: "Organizar y gestionar proyectos de construcción.",
              kuder_area: "Oficina",
            },
            {
              text: "Diseñar y construir un circuito eléctrico.",
              kuder_area: "Tecnológica",
            },
          ],
        },
        {
          id: 2,
          text: "¿Cuál de estas actividades te atrae más?",
          options: [
            {
              text: "Redactar informes técnicos detallados.",
              kuder_area: "Oficina",
            },
            {
              text: "Dar charlas sobre avances en ingeniería química.",
              kuder_area: "Científica",
            },
            {
              text: "Convencer a otros de un punto de vista.",
              kuder_area: "Comunicacional",
            },
            {
              text: "Reparar maquinaria industrial.",
              kuder_area: "Tecnológica",
            },
            {
              text: "Calcular el presupuesto de un proyecto económico internacional.",
              kuder_area: "Cálculo",
            },
          ],
        },
        {
          id: 3,
          text: "¿Qué tipo de trabajo te gustaría más?",
          options: [
            {
              text: "Crear una campaña publicitaria exitosa.",
              kuder_area: "Comunicacional",
            },
            {
              text: "Supervisar una obra de construcción.",
              kuder_area: "Tecnológica",
            },
            {
              text: "Escribir artículos sobre política internacional.",
              kuder_area: "Literaria",
            },
            {
              text: "Asesorar a personas sobre sus derechos.",
              kuder_area: "Jurídica",
            },
            {
              text: "Diseñar un sistema de redes de comunicación.",
              kuder_area: "Científica",
            },
          ],
        },
        {
          id: 4,
          text: "¿Qué actividad te resulta más interesante?",
          options: [
            {
              text: "Investigar sobre nuevos descubrimientos científicos.",
              kuder_area: "Científica",
            },
            {
              text: "Tomar clases de locución y expresión corporal.",
              kuder_area: "Comunicacional",
            },
            {
              text: "Organizar eventos corporativos para una empresa.",
              kuder_area: "Oficina",
            },
            {
              text: "Gestionar las finanzas de una empresa.",
              kuder_area: "Económica",
            },
            {
              text: "Analizar los resultados de una encuesta.",
              kuder_area: "Cálculo",
            },
          ],
        },
        {
          id: 5,
          text: "¿Qué prefieres hacer?",
          options: [
            {
              text: "Leer sobre historia de las civilizaciones.",
              kuder_area: "Literaria",
            },
            {
              text: "Dirigir un proyecto de desarrollo de software.",
              kuder_area: "Científica",
            },
            {
              text: "Coordinar la logística de una cadena de suministro.",
              kuder_area: "Económica",
            },
            {
              text: "Analizar el marco legal de un país.",
              kuder_area: "Jurídica",
            },
            {
              text: "Diseñar la estructura de un puente.",
              kuder_area: "Diseño",
            },
          ],
        },
        {
          id: 6,
          text: "¿Cuál de estas actividades te atrae más?",
          options: [
            {
              text: "Analizar las relaciones entre países.",
              kuder_area: "Económica",
            },
            {
              text: "Participar en una campaña de ayuda social.",
              kuder_area: "Asistencial",
            },
            {
              text: "Diseñar un nuevo producto industrial.",
              kuder_area: "Tecnológica",
            },
            {
              text: "Liderar un debate sobre temas de actualidad.",
              kuder_area: "Comunicacional",
            },
            {
              text: "Planificar y evaluar un proyecto de educación.",
              kuder_area: "Oficina",
            },
          ],
        },
        {
          id: 7,
          text: "¿Qué tipo de trabajo te gustaría más?",
          options: [
            {
              text: "Diseñar y construir maquinaria industrial.",
              kuder_area: "Tecnológica",
            },
            {
              text: "Asistir a una conferencia sobre los derechos de los trabajadores.",
              kuder_area: "Jurídica",
            },
            {
              text: "Calcular estadísticas para un estudio de mercado.",
              kuder_area: "Cálculo",
            },
            {
              text: "Traducir documentos importantes.",
              kuder_area: "Literaria",
            },
            {
              text: "Gestionar las operaciones de una fábrica.",
              kuder_area: "Oficina",
            },
          ],
        },
        {
          id: 8,
          text: "¿Qué actividad te resulta más interesante?",
          options: [
            {
              text: "Enseñar cómo funciona un motor.",
              kuder_area: "Tecnológica",
            },
            {
              text: "Dirigir la clasificación de datos para una empresa.",
              kuder_area: "Oficina",
            },
            {
              text: "Organizar una campaña política.",
              kuder_area: "Comunicacional",
            },
            {
              text: "Desarrollar un nuevo sistema de producción.",
              kuder_area: "Económica",
            },
            {
              text: "Analizar el desarrollo psicológico en adolescentes.",
              kuder_area: "Científica",
            },
          ],
        },
        {
          id: 9,
          text: "¿Qué prefieres hacer?",
          options: [
            {
              text: "Participar en un comité de ayuda social.",
              kuder_area: "Asistencial",
            },
            {
              text: "Diseñar una campaña publicitaria.",
              kuder_area: "Comunicacional",
            },
            {
              text: "Gestionar la agenda de un ejecutivo.",
              kuder_area: "Oficina",
            },
            {
              text: "Resolver problemas de programación complejos.",
              kuder_area: "Científica",
            },
            { text: "Preparar estados financieros.", kuder_area: "Cálculo" },
          ],
        },
        {
          id: 10,
          text: "¿Cuál de estas actividades te atrae más?",
          options: [
            {
              text: "Saber armar y desarmar computadoras.",
              kuder_area: "Tecnológica",
            },
            {
              text: "Crear una presentación persuasiva.",
              kuder_area: "Comunicacional",
            },
            { text: "Analizar datos financieros.", kuder_area: "Cálculo" },
            { text: "Escribir un cuento corto.", kuder_area: "Literaria" },
            {
              text: "Planificar la producción de una fábrica.",
              kuder_area: "Oficina",
            },
          ],
        },
        {
          id: 11,
          text: "¿Qué tipo de trabajo te gustaría más?",
          options: [
            {
              text: "Dar clases de oratoria y argumentación.",
              kuder_area: "Literaria",
            },
            {
              text: "Investigar sobre los nuevos usos de las matemáticas.",
              kuder_area: "Científica",
            },
            { text: "Gestionar un equipo de ventas.", kuder_area: "Económica" },
            {
              text: "Planificar una red eléctrica para una ciudad.",
              kuder_area: "Tecnológica",
            },
            {
              text: "Asesorar en materia de derecho corporativo.",
              kuder_area: "Jurídica",
            },
          ],
        },
        {
          id: 12,
          text: "¿Qué actividad te resulta más interesante?",
          options: [
            { text: "Aprender estadística.", kuder_area: "Cálculo" },
            {
              text: "Ser conocido(a) como un(a) buen(a) escritor(a).",
              kuder_area: "Literaria",
            },
            {
              text: "Diseñar y programar una aplicación móvil.",
              kuder_area: "Científica",
            },
            {
              text: "Gestionar proyectos para una ONG.",
              kuder_area: "Asistencial",
            },
            {
              text: "Negociar los términos de un contrato.",
              kuder_area: "Jurídica",
            },
          ],
        },
        {
          id: 13,
          text: "¿Qué prefieres hacer?",
          options: [
            {
              text: "Ser programador(a) en computación.",
              kuder_area: "Científica",
            },
            {
              text: "Manejar aparatos y máquinas industriales.",
              kuder_area: "Tecnológica",
            },
            {
              text: "Planificar un evento benéfico.",
              kuder_area: "Asistencial",
            },
            {
              text: "Llevar la contabilidad de una pequeña empresa.",
              kuder_area: "Oficina",
            },
            {
              text: "Influir en la opinión de un grupo de personas.",
              kuder_area: "Comunicacional",
            },
          ],
        },
        {
          id: 14,
          text: "¿Cuál de estas actividades te atrae más?",
          options: [
            {
              text: "Efectuar análisis de muestras de laboratorio.",
              kuder_area: "Científica",
            },
            {
              text: "Ayudar a resolver conflictos interpersonales.",
              kuder_area: "Asistencial",
            },
            { text: "Redactar un informe de gestión.", kuder_area: "Oficina" },
            {
              text: "Analizar inversiones y riesgos económicos.",
              kuder_area: "Económica",
            },
            { text: "Resolver disputas legales.", kuder_area: "Jurídica" },
          ],
        },
        {
          id: 15,
          text: "¿Qué tipo de trabajo te gustaría más?",
          options: [
            {
              text: "Asesorar a personas sobre sus derechos legales.",
              kuder_area: "Jurídica",
            },
            { text: "Analizar datos económicos.", kuder_area: "Cálculo" },
            { text: "Escribir un guion de cine.", kuder_area: "Literaria" },
            {
              text: "Gestionar el mantenimiento de equipos.",
              kuder_area: "Tecnológica",
            },
            {
              text: "Organizar una campaña de concientización social.",
              kuder_area: "Comunicacional",
            },
          ],
        },
      ];

      // --- Mapeo de Carreras de la UNIMET a Áreas de Kuder ---
      // La relevancia es un valor del 1 al 5, donde 5 es muy relevante.
      const unimetCareers = [
        {
          name: "Ingeniería Civil",
          description:
            "Atiende las necesidades y requerimientos del sistema productivo de un país, enfocada en diseño y gestión de infraestructura.",
          kuder_areas_relevance: {
            Tecnológica: 4,
            Cálculo: 5,
            Científica: 4,
            Oficina: 3,
            Diseño: 3,
          },
        },
        {
          name: "Ingeniería Mecánica",
          description:
            "Todo lo concerniente a máquinas y plantas industriales, desde el diseño hasta el mantenimiento.",
          kuder_areas_relevance: {
            Tecnológica: 5,
            Cálculo: 4,
            Científica: 4,
            Oficina: 2,
          },
        },
        {
          name: "Ingeniería Producción",
          description:
            "Organiza, planifica, mejora y controla los procesos de producción y servicios.",
          kuder_areas_relevance: {
            Oficina: 4,
            Cálculo: 4,
            Científica: 3,
            Económica: 3,
            Tecnológica: 2,
          },
        },
        {
          name: "Ingeniería Química",
          description:
            "Transforma materiales en productos útiles a través de procesos químicos.",
          kuder_areas_relevance: {
            Científica: 5,
            Cálculo: 4,
            Tecnológica: 3,
            Oficina: 2,
          },
        },
        {
          name: "Ingeniería de Sistemas",
          description:
            "Resuelve problemas complejos mediante el uso del enfoque de sistemas y tecnología.",
          kuder_areas_relevance: {
            Científica: 5,
            Cálculo: 4,
            Tecnológica: 4,
            Oficina: 3,
          },
        },
        {
          name: "Ingeniería Eléctrica",
          description:
            "Diseña, construye y mantiene instalaciones y equipos eléctricos y electrónicos.",
          kuder_areas_relevance: {
            Tecnológica: 5,
            Científica: 4,
            Cálculo: 4,
            Oficina: 2,
          },
        },
        {
          name: "Ciencias Administrativas (Gerencia / Banca y Finanzas)",
          description:
            "Formación en gerencia y finanzas para la toma de decisiones empresariales.",
          kuder_areas_relevance: {
            Oficina: 5,
            Cálculo: 4,
            Económica: 4,
            Comunicacional: 3,
          },
        },
        {
          name: "Economía Empresarial",
          description:
            "Resuelve problemas económicos en las diversas instancias laborales a través del análisis de datos.",
          kuder_areas_relevance: {
            Cálculo: 5,
            Científica: 4,
            Oficina: 3,
            Económica: 5,
          },
        },
        {
          name: "Contaduría Pública",
          description:
            "Comprende la gestión financiera y estratégica para la optimización de procesos.",
          kuder_areas_relevance: { Cálculo: 5, Oficina: 5, Económica: 4 },
        },
        {
          name: "Psicología",
          description:
            "Comprensión de la conducta humana en una amplia variedad de contextos y situaciones.",
          kuder_areas_relevance: {
            Asistencial: 5,
            Científica: 4,
            Literaria: 3,
            Comunicacional: 3,
          },
        },
        {
          name: "Matemáticas Industriales",
          description:
            "Aplicación de las matemáticas en los ámbitos académicos, financieros y tecnológicos.",
          kuder_areas_relevance: {
            Cálculo: 5,
            Científica: 4,
            Tecnológica: 3,
            Oficina: 3,
          },
        },
        {
          name: "Educación",
          description:
            "Formación en docencia, investigación y administración educativa.",
          kuder_areas_relevance: {
            Asistencial: 5,
            Literaria: 4,
            Comunicacional: 4,
            Oficina: 3,
          },
        },
        {
          name: "Idiomas Modernos",
          description:
            "Formación en comunicación interlingual e intercultural en inglés y la lengua materna.",
          kuder_areas_relevance: {
            Literaria: 5,
            Comunicacional: 4,
            Asistencial: 3,
          },
        },
        {
          name: "Comunicación Social y Empresarial",
          description:
            "Redefine la comunicación con dominio de tecnologías emergentes.",
          kuder_areas_relevance: {
            Literaria: 4,
            Comunicacional: 5,
            Diseño: 3,
            Oficina: 3,
          },
        },
        {
          name: "Estudios Liberales",
          description:
            "Programa interdisciplinario en Filosofía, Ética, Política, Economía e Historia.",
          kuder_areas_relevance: {
            Literaria: 4,
            Científica: 4,
            Asistencial: 3,
            Económica: 2,
            Jurídica: 3,
          },
        },
        {
          name: "Derecho",
          description:
            "Garantiza la paz, seguridad y derechos ciudadanos, regulando las acciones del poder público.",
          kuder_areas_relevance: {
            Comunicacional: 5,
            Literaria: 4,
            Asistencial: 4,
            Oficina: 3,
            Jurídica: 5,
          },
        },
        {
          name: "Estudios Internacionales",
          description:
            "Programa interdisciplinario que combina Relaciones Internacionales, Política, Derecho y Economía Global.",
          kuder_areas_relevance: {
            Científica: 4,
            Literaria: 3,
            Comunicacional: 4,
            Económica: 3,
            Asistencial: 2,
            Jurídica: 3,
          },
        },
      ];

      // --- Mapeo de Minors de la UNIMET a Áreas de Kuder ---
      const unimetMinors = [
        {
          name: "Principios de Ciencias de Datos",
          description:
            "Fundamentos de recolección, análisis e interpretación de datos.",
          subjects: [
            "Introducción a la Ciencia de Datos",
            "Análisis de Datos con Python",
            "Aprendizaje Automático",
          ],
          job_skills: [
            "Análisis de Big Data",
            "Visualización de Datos",
            "Modelado Predictivo",
          ],
          kuder_areas_relevance: { Cálculo: 5, Científica: 4, Oficina: 3 },
        },
        {
          name: "Mercadeo Digital",
          description: "Estrategias de marketing en entornos digitales.",
          subjects: ["Estrategia Digital", "Analítica Web", "SEO y SEM"],
          job_skills: [
            "Gestión de Campañas Digitales",
            "Análisis de Métricas",
            "Estrategia de Contenido",
          ],
          kuder_areas_relevance: { Comunicacional: 5, Oficina: 3, Diseño: 3 },
        },
        {
          name: "Políticas Públicas, Innovación Social y Sostenibilidad",
          description:
            "Diseño y análisis de políticas para el bienestar social.",
          subjects: [
            "Teoría de Políticas Públicas",
            "Sostenibilidad y Desarrollo",
            "Innovación Social",
          ],
          job_skills: [
            "Evaluación de Proyectos Sociales",
            "Gestión de Proyectos de Sostenibilidad",
            "Análisis de Entorno Social",
          ],
          kuder_areas_relevance: {
            Asistencial: 5,
            Científica: 4,
            Comunicacional: 3,
          },
        },
        {
          name: "Desarrollo de Software",
          description: "Creación y programación de aplicaciones.",
          subjects: [
            "Lógica de Programación",
            "Bases de Datos",
            "Desarrollo Frontend/Backend",
          ],
          job_skills: [
            "Programación en Múltiples Lenguajes",
            "Desarrollo de Aplicaciones Web",
            "Resolución de Problemas Lógicos",
          ],
          kuder_areas_relevance: { Tecnológica: 5, Científica: 4, Cálculo: 3 },
        },
        {
          name: "Gestión de la Cadena de Suministro",
          description:
            "Administración de la logística y el flujo de productos.",
          subjects: [
            "Logística y Distribución",
            "Gestión de Inventarios",
            "Operaciones Industriales",
          ],
          job_skills: [
            "Optimización de Procesos Logísticos",
            "Negociación con Proveedores",
            "Planificación de la Demanda",
          ],
          kuder_areas_relevance: { Oficina: 5, Cálculo: 4, Económica: 3 },
        },
        {
          name: "Oratoria y Negociación",
          description:
            "Desarrollo de habilidades para hablar en público y negociar.",
          subjects: [
            "Comunicación Persuasiva",
            "Técnicas de Negociación",
            "Discurso y Argumentación",
          ],
          job_skills: [
            "Comunicación Efectiva",
            "Liderazgo de Equipos",
            "Resolución de Conflictos",
          ],
          kuder_areas_relevance: { Comunicacional: 5, Literaria: 4 },
        },
        {
          name: "Gestión para Abogados",
          description: "Principios de gestión aplicados al ámbito legal.",
          subjects: [
            "Gerencia Estratégica",
            "Finanzas y Contabilidad",
            "Derecho Corporativo",
          ],
          job_skills: [
            "Gestión de Despachos",
            "Toma de Decisiones Financieras",
            "Análisis de Riesgos Legales",
          ],
          kuder_areas_relevance: { Oficina: 4, Jurídica: 3, Económica: 2 },
        },
        {
          name: "Estudios Internacionales",
          description: "Análisis de la política, economía y derecho global.",
          subjects: [
            "Relaciones Internacionales",
            "Derecho Internacional",
            "Geopolítica",
          ],
          job_skills: [
            "Análisis de Escenarios Globales",
            "Negociación Internacional",
            "Consultoría Política",
          ],
          kuder_areas_relevance: {
            Científica: 4,
            Literaria: 3,
            Comunicacional: 4,
            Económica: 3,
            Asistencial: 2,
            Jurídica: 3,
          },
        },
        {
          name: "Diseño Gráfico Computarizado",
          description:
            "Creación de elementos visuales con herramientas digitales.",
          subjects: [
            "Fundamentos del Diseño",
            "Software de Diseño",
            "Tipografía",
          ],
          job_skills: [
            "Creación de Identidad Visual",
            "Diseño de Interfaces",
            "Producción de Material Gráfico",
          ],
          kuder_areas_relevance: { Diseño: 5, Tecnológica: 3 },
        },
      ];

      // --- Variables de Estado de la Aplicación ---
      let currentQuestionIndex = 0;
      let studentName = "";
      let studentId = "";
      let userAnswers = new Array(kuderQuestions.length).fill([]);
      let kuderScores = {};

      // --- Referencias a Elementos del DOM ---
      const introSection = document.getElementById("intro-section");
      const testSection = document.getElementById("test-section");
      const resultsSection = document.getElementById("results-section");
      const startTestBtn = document.getElementById("start-test-btn");
      const studentNameInput = document.getElementById("student-name");
      const studentIdInput = document.getElementById("student-id");
      const currentQuestionNumberSpan = document.getElementById(
        "current-question-number"
      );
      const totalQuestionsSpan = document.getElementById("total-questions");
      const questionTextP = document.getElementById("question-text");
      const optionsContainerDiv = document.getElementById("options-container");
      const prevQuestionBtn = document.getElementById("prev-question-btn");
      const nextQuestionBtn = document.getElementById("next-question-btn");
      const submitTestBtn = document.getElementById("submit-test-btn");
      const resultsStudentNameSpan = document.getElementById(
        "results-student-name"
      );
      const topInterestsDisplayDiv = document.getElementById(
        "top-interests-display"
      );
      const careerSuggestionsUl = document.getElementById("career-suggestions");
      const minorSuggestionsUl = document.getElementById("minor-suggestions");
      const exportResultsBtn = document.getElementById("export-results-btn");
      const messageBox = document.getElementById("message-box");
      const messageText = document.getElementById("message-text");

      // --- Funciones de la Aplicación ---

      function showMessage(text, type = "error") {
        messageText.textContent = text;
        messageBox.className = `mt-6 px-4 py-3 rounded relative ${
          type === "error"
            ? "bg-red-100 border border-red-400 text-red-700"
            : "bg-green-100 border border-green-400 text-green-700"
        }`;
        messageBox.classList.remove("hidden");
        setTimeout(() => {
          messageBox.classList.add("hidden");
        }, 5000);
      }

      function startTest() {
        studentName = studentNameInput.value.trim();
        studentId = studentIdInput.value.trim();

        if (!studentName || !studentId) {
          showMessage("Por favor, ingresa tu nombre y cédula para comenzar.");
          return;
        }

        introSection.classList.add("hidden");
        testSection.classList.remove("hidden");
        currentQuestionIndex = 0;
        totalQuestionsSpan.textContent = kuderQuestions.length;
        displayQuestion();
        updateNavigationButtons();
      }

      function displayQuestion() {
        const question = kuderQuestions[currentQuestionIndex];
        questionTextP.textContent = `${currentQuestionIndex + 1}. ${
          question.text
        }`;
        optionsContainerDiv.innerHTML = "";

        question.options.forEach((option, index) => {
          const label = document.createElement("label");
          label.className = "checkbox-option";
          const isChecked = userAnswers[currentQuestionIndex].includes(
            String(index)
          );
          if (isChecked) {
            label.classList.add("selected");
          }
          label.innerHTML = `
                    <input type="checkbox" name="question-${question.id}" value="${index}" data-kuder-area="${option.kuder_area}" class="form-checkbox">
                    <span>${option.text}</span>
                `;
          optionsContainerDiv.appendChild(label);

          label.querySelector("input").checked = isChecked;

          label.querySelector("input").addEventListener("change", (e) => {
            const selectedCount =
              optionsContainerDiv.querySelectorAll("input:checked").length;
            if (selectedCount > 2) {
              e.target.checked = false;
              showMessage(
                "Solo puedes seleccionar un máximo de 2 opciones por pregunta."
              );
            } else {
              if (e.target.checked) {
                label.classList.add("selected");
              } else {
                label.classList.remove("selected");
              }
            }
          });
        });

        currentQuestionNumberSpan.textContent = currentQuestionIndex + 1;
        updateNavigationButtons();
      }

      function updateNavigationButtons() {
        prevQuestionBtn.disabled = currentQuestionIndex === 0;
        if (currentQuestionIndex === kuderQuestions.length - 1) {
          nextQuestionBtn.classList.add("hidden");
          submitTestBtn.classList.remove("hidden");
        } else {
          nextQuestionBtn.classList.remove("hidden");
          submitTestBtn.classList.add("hidden");
        }
      }

      function nextQuestion() {
        const selectedOptions = optionsContainerDiv.querySelectorAll(
          `input[name="question-${kuderQuestions[currentQuestionIndex].id}"]:checked`
        );
        if (selectedOptions.length === 0) {
          showMessage(
            "Por favor, selecciona al menos una opción antes de continuar."
          );
          return;
        }

        userAnswers[currentQuestionIndex] = Array.from(selectedOptions).map(
          (opt) => opt.value
        );

        if (currentQuestionIndex < kuderQuestions.length - 1) {
          currentQuestionIndex++;
          displayQuestion();
        } else {
          submitTest();
        }
      }

      function prevQuestion() {
        if (currentQuestionIndex > 0) {
          const selectedOptions = optionsContainerDiv.querySelectorAll(
            `input[name="question-${kuderQuestions[currentQuestionIndex].id}"]:checked`
          );
          userAnswers[currentQuestionIndex] = Array.from(selectedOptions).map(
            (opt) => opt.value
          );
          currentQuestionIndex--;
          displayQuestion();
        }
      }

      function submitTest() {
        const selectedOptions = optionsContainerDiv.querySelectorAll(
          `input[name="question-${kuderQuestions[currentQuestionIndex].id}"]:checked`
        );
        if (selectedOptions.length === 0) {
          showMessage(
            "Por favor, selecciona al menos una opción para la última pregunta antes de finalizar."
          );
          return;
        }
        userAnswers[currentQuestionIndex] = Array.from(selectedOptions).map(
          (opt) => opt.value
        );

        calculateKuderScores();
        displayResults();
      }

      function calculateKuderScores() {
        kuderScores = {
          Cálculo: 0,
          Científica: 0,
          Diseño: 0,
          Tecnológica: 0,
          Sanitaria: 0,
          Asistencial: 0,
          Jurídica: 0,
          Económica: 0,
          Comunicacional: 0,
          Literaria: 0,
          Musical: 0,
          Oficina: 0,
          Exterior: 0,
        };
        userAnswers.forEach((optionIndexes, questionIndex) => {
          optionIndexes.forEach((optionIndex) => {
            const area =
              kuderQuestions[questionIndex].options[optionIndex].kuder_area;
            if (area && kuderScores.hasOwnProperty(area)) {
              kuderScores[area]++;
            }
          });
        });
      }

      function getTopKuderInterests(num = 3) {
        return Object.entries(kuderScores)
          .sort(([, scoreA], [, scoreB]) => scoreB - scoreA)
          .slice(0, num)
          .filter(([, score]) => score > 0);
      }

      function getCareerRecommendations() {
        const topInterests = getTopKuderInterests(5);
        const careerAffinities = [];
        const hasLiteraria = topInterests.some(
          ([area]) => area === "Literaria"
        );
        const hasComunicacional = topInterests.some(
          ([area]) => area === "Comunicacional"
        );
        const hasJuridica = topInterests.some(([area]) => area === "Jurídica");

        unimetCareers.forEach((career) => {
          let affinityScore = 0;
          topInterests.forEach(([area, userScore]) => {
            const relevance = career.kuder_areas_relevance[area] || 0;
            affinityScore += userScore * relevance;
          });

          if (hasLiteraria && hasComunicacional) {
            if (
              career.name === "Estudios Internacionales" ||
              career.name === "Estudios Liberales" ||
              career.name === "Derecho"
            ) {
              affinityScore += 20;
            }
          }

          if (affinityScore > 0) {
            careerAffinities.push({ ...career, affinityScore });
          }
        });

        return careerAffinities
          .sort((a, b) => b.affinityScore - a.affinityScore)
          .slice(0, 3);
      }

      function getMinorRecommendations() {
        const topInterests = getTopKuderInterests(5);
        const minorAffinities = [];

        unimetMinors.forEach((minor) => {
          let affinityScore = 0;
          topInterests.forEach(([area, userScore]) => {
            const relevance = minor.kuder_areas_relevance[area] || 0;
            affinityScore += userScore * relevance;
          });
          if (affinityScore > 0) {
            minorAffinities.push({ ...minor, affinityScore });
          }
        });

        return minorAffinities
          .sort((a, b) => b.affinityScore - a.affinityScore)
          .slice(0, 3);
      }

      function displayResults() {
        testSection.classList.add("hidden");
        resultsSection.classList.remove("hidden");

        resultsStudentNameSpan.textContent = studentName;

        topInterestsDisplayDiv.innerHTML = "";
        const topInterests = getTopKuderInterests(5);
        if (topInterests.length > 0) {
          topInterests.forEach(([area, score]) => {
            const span = document.createElement("span");
            span.className = "kuder-area-tag";
            span.textContent = `${area} (${score} puntos)`;
            topInterestsDisplayDiv.appendChild(span);
          });
        } else {
          topInterestsDisplayDiv.textContent =
            "No se pudieron determinar intereses claros. Asegúrate de haber respondido todas las preguntas.";
        }

        careerSuggestionsUl.innerHTML = "";
        const recommendedCareers = getCareerRecommendations();
        if (recommendedCareers.length > 0) {
          recommendedCareers.forEach((career) => {
            const li = document.createElement("li");
            li.innerHTML = `<span class="font-semibold">${career.name}:</span> ${career.description}`;
            careerSuggestionsUl.appendChild(li);
          });
        } else {
          const li = document.createElement("li");
          li.textContent =
            "No se encontraron sugerencias de carreras basadas en tus intereses. Considera explorar todas las opciones de la UNIMET.";
          careerSuggestionsUl.appendChild(li);
        }

        minorSuggestionsUl.innerHTML = "";
        const recommendedMinors = getMinorRecommendations();
        if (recommendedMinors.length > 0) {
          recommendedMinors.forEach((minor) => {
            const li = document.createElement("li");
            let subjectsHtml = "";
            if (minor.subjects && minor.subjects.length > 0) {
              subjectsHtml =
                `<p class="mt-2 text-sm font-medium text-gray-700">Materias:</p>` +
                `<ul class="list-disc pl-5 text-sm text-gray-600">` +
                minor.subjects.map((s) => `<li>${s}</li>`).join("") +
                `</ul>`;
            }
            let skillsHtml = "";
            if (minor.job_skills && minor.job_skills.length > 0) {
              skillsHtml =
                `<p class="mt-2 text-sm font-medium text-gray-700">Capacidades Laborales:</p>` +
                `<ul class="list-disc pl-5 text-sm text-gray-600">` +
                minor.job_skills.map((s) => `<li>${s}</li>`).join("") +
                `</ul>`;
            }
            li.innerHTML = `<span class="font-semibold">${minor.name}:</span> ${minor.description}${subjectsHtml}${skillsHtml}`;
            minorSuggestionsUl.appendChild(li);
          });
        } else {
          const li = document.createElement("li");
          li.textContent =
            "No se encontraron sugerencias de minors basadas en tus intereses. Considera explorar todas las opciones de la UNIMET.";
          minorSuggestionsUl.appendChild(li);
        }
      }

      function exportResults() {
        const topInterests = getTopKuderInterests(5)
          .map(([area, score]) => `${area} (${score} puntos)`)
          .join(", ");
        const careersText = getCareerRecommendations()
          .map((c) => `- ${c.name}: ${c.description}`)
          .join("\n");
        const minorsText = getMinorRecommendations()
          .map((m) => {
            const subjects =
              m.subjects && m.subjects.length > 0
                ? `\n    Materias: ${m.subjects.join(", ")}`
                : "";
            const skills =
              m.job_skills && m.job_skills.length > 0
                ? `\n    Capacidades Laborales: ${m.job_skills.join(", ")}`
                : "";
            return `- ${m.name}: ${m.description}${subjects}${skills}`;
          })
          .join("\n\n");

        const finalPhrase = `Este estudio te permite acercarte a tu decisión vocacional y construir tu plan de carrera en la Unimet. Si quieres profundizar más, escríbenos a la DDBE@UNIMET.EDU.VE para que participes en nuestro programa vocacional sin ningún costo.`;

        const resultsContent = `
Resultados del Test de Intereses Vocacionales UNIMET

Nombre del Alumno: ${studentName}
Cédula de Identidad: ${studentId}

--- Perfil de Intereses Kuder ---
Tus intereses principales son: ${
          topInterests || "No se pudieron determinar intereses claros."
        }

--- Sugerencias de Carreras en la UNIMET ---
${careersText || "No se encontraron sugerencias de carreras."}

--- Sugerencias de Minors en la UNIMET ---
${minorsText || "No se encontraron sugerencias de minors."}

---
${finalPhrase}
            `.trim();

        const blob = new Blob([resultsContent], {
          type: "text/plain;charset=utf-8",
        });
        const link = document.createElement("a");
        link.href = URL.createObjectURL(blob);
        link.download = `Resultados_Vocacionales_${studentName.replace(
          /\s/g,
          "_"
        )}.txt`;
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
        showMessage("Resultados exportados exitosamente.", "success");
      }

      // --- Event Listeners ---
      startTestBtn.addEventListener("click", startTest);
      nextQuestionBtn.addEventListener("click", nextQuestion);
      prevQuestionBtn.addEventListener("click", prevQuestion);
      submitTestBtn.addEventListener("click", submitTest);
      exportResultsBtn.addEventListener("click", exportResults);

      document.addEventListener("DOMContentLoaded", () => {
        studentNameInput.value = "";
        studentIdInput.value = "";
      });
    </script>
  </body>
</html>
